---
import Layout from '../../layouts/Layout.astro'
import Container from '../../components/Container.astro'
import FormattedDate from '../../components/FormattedDate.astro'
import { readingTime } from '../../lib/utils'
import { type CollectionEntry, getCollection } from 'astro:content'
import { SITE } from '../../consts'
import { clsx } from 'clsx'

export async function getStaticPaths() {
  const writings = (await getCollection('writings')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
  )

  return writings.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}

type Props = CollectionEntry<'writings'>

const post = Astro.props

// URLs
const postURL = new URL(Astro.url, Astro.site).toString()

// Cover image
const coverImage = new URL(`/og/${post.slug}.png`, Astro.site).toString()

// Word count
const wordCount = post.body.split(/\s+/).length

const { Content } = await post.render()

const { pubDate, tags, title, description } = post.data
---

<Layout title={title} description={description} image={coverImage}>
  <Container>
    <!-- JSON-LD Schema for Blog Post -->
    <script
      is:inline
      type="application/ld+json"
      set:html={JSON.stringify({
        '@context': 'https://schema.org',
        '@type': 'BlogPosting',
        headline: title,
        description: description,
        url: postURL,
        mainEntityOfPage: {
          '@type': 'WebPage',
          '@id': postURL,
        },
        image: coverImage,
        datePublished: pubDate,
        dateModified: pubDate,
        author: {
          '@type': 'Person',
          '@id': `${Astro.site}#me`,
          name: SITE.NAME,
          url: Astro.site,
          image: `${Astro.site}assets/profile.png`,
        },
        keywords: tags,
        wordCount,
        text: post.body,
        isPartOf: {
          '@type': 'Blog',
          name: SITE.NAME,
          url: `${Astro.site}blog`,
        },
      })}
    />



			<article
				id='blog-content'
				class='w-full flex flex-col gap-6 items-center justify-center'>
				<h1
					class='w-full text-4xl md:text-5xl lg:text-7xl font-medium tracking-tight'>
					{title}
				</h1>
				<div class='flex flex-row gap-2 w-full'>
					<p class='text-start text-gray-500 font-medium'>
						<FormattedDate date={pubDate.toString()} />
					</p>
					<span class='text-gray-500 font-medium'>Â·</span>
					<p class='text-start text-gray-500 font-medium'>
						{readingTime} min read
					</p>
				</div>
				<p
					class='w-full text-start font-medium text-gray-700 dark:text-gray-300 text-lg'>
					<span class='font-semibold text-gray-900 dark:text-white'
						>tl;dr:
					</span>
					{description}
				</p>
		
				<div
					class={clsx(
						'w-full prose prose-lg my-3 prose-p:font-medium dark:prose-invert prose-a:underline prose-a:bg-orange-50 prose-a:decoration-orange-500 items-center justify-center',
						'dark:prose-a:bg-orange-950 dark:prose-a:decoration-orange-400 dark:prose-a:underline',
						'prose-h1:font-medium prose-h2:font-medium prose-h3:font-medium prose-h4:font-medium prose-h5:font-medium prose-h6:font-medium',
						'prose-h1:tracking-tight prose-h2:tracking-tight prose-h3:tracking-tight prose-h4:tracking-tight prose-h5:tracking-tight prose-h6:tracking-tight',
						'prose-ul:font-medium prose-ol:font-medium prose-li:font-medium',
						'prose-ul:space-y-3 prose-ol:space-y-3 prose-li:space-y-3'
					)}>
					<slot />
				</div>
			</article>
		






  </Container>
</Layout>
